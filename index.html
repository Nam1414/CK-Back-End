<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n l√Ω ƒë∆°n h√†ng</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Login Page */
    .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
    }

    .login-box {
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        width: 100%;
        max-width: 400px;
    }

    .login-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .login-header h1 {
        color: #667eea;
        font-size: 28px;
        margin-bottom: 10px;
    }

    .login-header p {
        color: #666;
        font-size: 14px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
    }

    .form-group input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s;
    }

    .form-group input:focus {
        outline: none;
        border-color: #667eea;
    }

    .required-mark {
        color: red;
        margin-left: 4px;
    }

    .btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .btn:hover {
        transform: translateY(-2px);
    }

    .auth-links {
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
        color: #666;
    }

    .auth-links a {
        color: #667eea;
        font-weight: 600;
        text-decoration: none;
        margin-left: 5px;
        cursor: pointer;
    }
    /*Register Page*/
    .register-container
    {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .register-container {
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        width: 100%;
        max-width: 500px;
        animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .register-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .register-header h1 {
        color: #667eea;
        font-size: 28px;
        margin-bottom: 10px;
    }

    .register-header p {
        color: #666;
        font-size: 14px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
        font-size: 14px;
    }

    .required-mark {
        color: red;
        margin-left: 2px;
    }

    .form-group input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s;
    }

    .form-group input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-group input:disabled {
        background: #f0f0f0;
        cursor: not-allowed;
    }

    .password-strength {
        margin-top: 5px;
        font-size: 12px;
        height: 4px;
        background: #e0e0e0;
        border-radius: 2px;
        overflow: hidden;
        display: none;
    }

    .password-strength.show {
        display: block;
    }

    .password-strength-bar {
        height: 100%;
        transition: all 0.3s;
    }

    .password-strength-bar.weak {
        width: 33%;
        background: #dc3545;
    }

    .password-strength-bar.medium {
        width: 66%;
        background: #ffc107;
    }

    .password-strength-bar.strong {
        width: 100%;
        background: #28a745;
    }

    .password-hint {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }

    .btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-top: 10px;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn:active {
        transform: translateY(0);
    }

    .auth-links {
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
        color: #666;
    }

    .auth-links a {
        color: #667eea;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
    }

    .auth-links a:hover {
        text-decoration: underline;
    }

    .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
        animation: shake 0.5s;
    }

    .error-message.show {
        display: block;
    }

    .success-message {
        background: #d4edda;
        color: #155724;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
    }

    .success-message.show {
        display: block;
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    .info-box {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 12px;
        border-radius: 4px;
        margin-bottom: 20px;
        font-size: 13px;
        color: #1565c0;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    @media (max-width: 600px) {
        .register-container {
            padding: 30px 20px;
        }

        .form-row {
            grid-template-columns: 1fr;
        }
}

    /* Main App */
    .app-container {
        display: none;
    }

    .app-container.active {
        display: block;
    }

    .header {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header-left h1 {
        color: #333;
        font-size: 24px;
        margin-bottom: 5px;
    }

    .header-right {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .btn-logout {
        background: #dc3545;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .btn-logout:hover {
        background: #c82333;
    }

    /* Stats Cards */
    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: white;
    }

    /* Updated Colors */
    .stat-card.blue { background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%); } /* Total Orders */
    .stat-card.yellow { background: linear-gradient(135deg, #fda085 0%, #f6d365 100%); } /* Pending */
    .stat-card.green { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); } /* Completed */
    .stat-card.purple { background: linear-gradient(135deg, #b721ff 0%, #21d4fd 100%); } /* Revenue */

    .stat-info h3 {
        font-size: 14px;
        margin-bottom: 10px;
        opacity: 0.9;
    }

    .stat-info p {
        font-size: 32px;
        font-weight: bold;
    }

    .stat-icon {
        font-size: 48px;
        opacity: 0.8;
    }

    /* Action Bar */
    .action-bar {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #c471f5 0%, #fa71cd 100%); /* Updated Create Order Gradient */
        color: white;
        padding: 12px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        transition: transform 0.2s;
        margin-right: 6px;
        vertical-align: middle; 
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        filter: brightness(1.1);
    }

    .filter-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 10px 20px;
        border: 2px solid #e0e0e0;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .filter-btn:hover {
        background: #f5f5f5;
    }

    .filter-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
    }

    /* Orders List */
    .orders-container {
        display: grid;
        gap: 20px;
    }

    .order-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .order-id {
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }

    .order-date {
        color: #666;
        font-size: 13px;
    }

    .order-creator {
        color: #667eea;
        font-size: 13px;
        margin-top: 5px;
    }

    .status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
    }

    .status-pending { background: #fff3cd; color: #856404; }
    .status-processing { background: #cce5ff; color: #004085; }
    .status-completed { background: #d4edda; color: #155724; }
    .status-cancelled { background: #f8d7da; color: #721c24; }

    .order-details {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .customer-info h4 {
        color: #666;
        font-size: 13px;
        margin-bottom: 8px;
    }

    .customer-info p {
        color: #333;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .order-total {
        text-align: right;
    }

    .order-total h4 {
        color: #666;
        font-size: 13px;
        margin-bottom: 8px;
    }

    .order-total p {
        color: #667eea;
        font-size: 28px;
        font-weight: bold;
    }

    .order-items {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .order-items h4 {
        color: #333;
        margin-bottom: 12px;
        font-size: 14px;
    }

    .item-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #e0e0e0;
        font-size: 14px;
    }

    .item-row:last-child {
        border-bottom: none;
    }

    .order-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .btn-action {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        transition: all 0.3s;
    }

    .btn-process { background: #007bff; color: white; }
    .btn-process:hover { background: #0056b3; }

    .btn-complete { background: #28a745; color: white; }
    .btn-complete:hover { background: #218838; }

    .btn-cancel { background: #dc3545; color: white; }
    .btn-cancel:hover { background: #c82333; }

    .btn-delete { background: #6c757d; color: white; }
    .btn-delete:hover { background: #5a6268; }

    .btn-settings {
    background: linear-gradient(90deg, #33539E, #ba83a4);
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 5px;
    }
    .btn-settings:hover {
        filter: brightness(1.1);
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 700px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        margin-bottom: 25px;
    }

    .modal-header h2 {
        color: #333;
        font-size: 24px;
    }

    .product-selector {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    .product-selector select {
        flex: 1;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
    }

    .product-selector input {
        width: 80px;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
    }

    .btn-add {
        padding: 12px 24px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
    }

    .selected-items {
        margin-top: 20px;
    }

    .selected-item {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .item-details h4 {
        color: #333;
        margin-bottom: 5px;
    }

    .item-details p {
        color: #666;
        font-size: 13px;
    }

    .btn-remove {
        background: #dc3545;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
    }

    .order-total-box {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .order-total-box h3 {
        color: #333;
        font-size: 18px;
    }

    .order-total-box p {
        color: #667eea;
        font-size: 28px;
        font-weight: bold;
    }

    .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 25px;
    }

    .btn-secondary {
        padding: 12px 24px;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
    }

    .empty-state {
        background: white;
        padding: 60px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .empty-state-icon {
        font-size: 80px;
        color: #e0e0e0;
        margin-bottom: 20px;
    }

    .empty-state p {
        color: #999;
        font-size: 18px;
    }

    .user-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #eee;
    }
    .user-list-item:last-child {
        border-bottom: none;
    }

    @media (max-width: 768px) {
        .header {
            flex-direction: column;
            gap: 15px;
        }

        .order-details {
            grid-template-columns: 1fr;
        }

        .order-total {
            text-align: left;
        }

        .stats-container {
            grid-template-columns: 1fr;
        }

        .product-selector {
            flex-direction: column;
        }

        .product-selector input {
            width: 100%;
        }
    }
</style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
</head>
<body>
<!-- Login Page -->
<div id="loginPage" class="login-container">
    <div class="login-box">
        <div class="login-header">
            <h1>üõí Qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
            <p id="authSubtitle">ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c</p>
        </div>

        <!-- Login Form -->
        <form id="loginForm">
            <div class="form-group">
                <label>T√™n ƒëƒÉng nh·∫≠p <span class="required-mark">*</span></label>
                <input type="text" id="username" required placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
            </div>
            <div class="form-group">
                <label>M·∫≠t kh·∫©u <span class="required-mark">*</span></label>
                <input type="password" id="password" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
            </div>
            <div style="text-align: right; margin-bottom: 15px;">
                <a href="#" id="forgotPasswordLink" style="color: #667eea; font-size: 14px; text-decoration: none;">Qu√™n m·∫≠t kh·∫©u?</a>
            </div>
            <button type="submit" class="btn">ƒêƒÉng nh·∫≠p</button>
        </form>

        <!-- Register Form -->
        <form id="registerForm" style="display: none;">
            <div class="form-group">
                <label>T√™n ƒëƒÉng nh·∫≠p <span class="required-mark">*</span></label>
                <input type="text" id="regUsername" required placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
            </div>
            <div class="form-group">
                <label>H·ªç v√† t√™n <span class="required-mark">*</span></label>
                <input type="text" id="regFullName" required placeholder="Nh·∫≠p h·ªç v√† t√™n">
            </div>
            <div class="form-group">
                <label>M·∫≠t kh·∫©u <span class="required-mark">*</span></label>
                <input type="password" id="regPassword" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u (t·ªëi thi·ªÉu 6 k√Ω t·ª±)">
            </div>
            <div class="form-group">
                <label>X√°c nh·∫≠n m·∫≠t kh·∫©u <span class="required-mark">*</span></label>
                <input type="password" id="regConfirmPassword" required placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">
            </div>
            <button type="submit" class="btn">ƒêƒÉng k√Ω</button>
            <div class="auth-links">
                <a href="#" onclick="showLogin()">Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
            </div>
        </form>

        <!-- Forgot Password Form -->
        <div id="forgotPasswordForm" style="display: none;">
            <!-- Step 1: Request OTP -->
            <form id="fpStep1">
                <div class="form-group">
                    <label>Email / S·ªë ƒëi·ªán tho·∫°i <span class="required-mark">*</span></label>
                    <input type="text" id="fpIdentity" required placeholder="Nh·∫≠p email ho·∫∑c s·ªë ƒëi·ªán tho·∫°i">
                </div>
                <button type="submit" class="btn">G·ª≠i m√£ x√°c nh·∫≠n</button>
            </form>

            <!-- Step 2: Verify OTP -->
            <form id="fpStep2" style="display: none;">
                <div class="form-group">
                    <label>M√£ x√°c nh·∫≠n (OTP) <span class="required-mark">*</span></label>
                    <input type="text" id="fpOtp" required placeholder="Nh·∫≠p m√£ (123456)">
                </div>
                <button type="submit" class="btn">X√°c nh·∫≠n</button>
            </form>

            <!-- Step 3: Reset Password -->
            <form id="fpStep3" style="display: none;">
                <div class="form-group">
                    <label>M·∫≠t kh·∫©u m·ªõi <span class="required-mark">*</span></label>
                    <input type="password" id="fpNewPass" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
                </div>
                <div class="form-group">
                    <label>X√°c nh·∫≠n m·∫≠t kh·∫©u <span class="required-mark">*</span></label>
                    <input type="password" id="fpConfirmPass" required placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
                </div>
                <button type="submit" class="btn">ƒê·ªïi m·∫≠t kh·∫©u</button>
            </form>
            
             <div class="auth-links">
                <a href="#" onclick="showLogin()">Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
            </div>
        </div>

        <!-- Toggle Login/Register -->
        <div id="authToggleContainer" class="auth-links">
            <span id="toggleText">Ch∆∞a c√≥ t√†i kho·∫£n?</span>
            <button id="toggleAuth" style="background:none;border:none;color:#667eea;cursor:pointer;padding:0;">
                ƒêƒÉng k√Ω ngay
            </button>
        </div>
    </div>
</div>

<!-- Main App -->
<div id="appPage" class="app-container">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>üõí Qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
                <p id="userRole">Qu·∫£n tr·ªã vi√™n</p>
            </div>
            <div class="header-right">
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
                <button class="btn-settings" onclick="openProfileModal()">
                    <i class="fa fa-cog"></i> C√†i ƒë·∫∑t
                </button>
                <button class="btn-logout" onclick="logout()">
                    <i class="fa fa-sign-out"></i> ƒêƒÉng xu·∫•t
                </button>
            </div>
        </div>

        <!-- Stats -->
         <div class="stats-container">
            <div class="stat-card blue">
                <div class="stat-info">
                    <h3>T·ªïng ƒë∆°n h√†ng</h3>
                    <p id="totalOrders">0</p>
                </div>
                <div class="stat-icon">
                    <i class="fa fa-archive"></i>
                </div>
            </div>
            <div class="stat-card yellow">
                <div class="stat-info">
                    <h3>Ch·ªù x·ª≠ l√Ω</h3>
                    <p id="pendingOrders">0</p>
                </div>
                <div class="stat-icon">
                    <i class="fa fa-clock-o"></i>
                </div>
            </div>
            <div class="stat-card green">
                <div class="stat-info">
                    <h3>Ho√†n th√†nh</h3>
                    <p id="completedOrders">0</p>
                </div>
                <div class="stat-icon">
                    <i class="fa fa-check-circle"></i>
                </div>
            </div>
            <div class="stat-card purple">
                <div class="stat-info">
                    <h3 id="revenueLabel">Doanh thu</h3>
                    <p id="revenue">0‚Ç´</p>
                </div>
                <div class="stat-icon">
                    <i class="fa fa-bar-chart"></i>
                </div>
            </div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
            <button class="btn-primary" onclick="openModal()">
                <i class="fa fa-plus"></i> T·∫°o ƒë∆°n h√†ng m·ªõi
            </button>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterOrders('all')">T·∫•t c·∫£</button>
                <button class="filter-btn" onclick="filterOrders('pending')">Ch·ªù x·ª≠ l√Ω</button>
                <button class="filter-btn" onclick="filterOrders('processing')">ƒêang x·ª≠ l√Ω</button>
                <button class="filter-btn" onclick="filterOrders('completed')">Ho√†n th√†nh</button>
                <button class="filter-btn" onclick="filterOrders('cancelled')">ƒê√£ h·ªßy</button>
            </div>
        </div>

        <!-- Orders List -->
        <div class="orders-container" id="ordersContainer">
            <!-- Content rendered by JS -->
        </div>
    </div>
</div>

<!-- Create Order Modal -->
<div id="orderModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>T·∫°o ƒë∆°n h√†ng m·ªõi</h2>
        </div>
        <form id="orderForm">
            <div class="form-group">
                <label>T√™n kh√°ch h√†ng <span class="required-mark">*</span></label>
                <input type="text" id="customerName" required placeholder="Nh·∫≠p t√™n kh√°ch h√†ng">
            </div>
            <div class="form-group">
                <label>S·ªë ƒëi·ªán tho·∫°i <span class="required-mark">*</span></label>
                <input type="tel" id="customerPhone" required placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
            </div>
            <div class="form-group">
                <label>ƒê·ªãa ch·ªâ <span class="required-mark">*</span></label>
                <input type="text" id="customerAddress" required placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
            </div>

            <hr style="margin: 25px 0; border: none; border-top: 2px solid #f0f0f0;">

            <h3 style="margin-bottom: 15px; color: #333;">Th√™m s·∫£n ph·∫©m</h3>
            <div class="product-selector">
                <select id="productSelect">
                    <option value="">Ch·ªçn s·∫£n ph·∫©m</option>
                </select>
                <input type="number" id="quantity" min="1" value="1" placeholder="S·ªë l∆∞·ª£ng">
                <button type="button" class="btn-add" onclick="addProduct()">Th√™m</button>
            </div>

            <div class="selected-items" id="selectedItems"></div>

            <div class="order-total-box" id="totalBox" style="display: none;">
                <h3>T·ªïng c·ªông:</h3>
                <p id="orderTotal">0‚Ç´</p>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeModal()">H·ªßy</button>
                <button type="submit" class="btn-primary">T·∫°o ƒë∆°n h√†ng</button>
            </div>
        </form>
    </div>
</div>

<!-- Profile Settings Modal -->
<div id="profileModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚öôÔ∏è C√†i ƒë·∫∑t t√†i kho·∫£n</h2>
        </div>
        <form id="profileForm">
            <div class="form-group">
                <label>T√™n ƒëƒÉng nh·∫≠p</label>
                <input type="text" id="profileUsername" disabled style="background: #f0f0f0; cursor: not-allowed;">
            </div>
            <div class="form-group">
                <label>Vai tr√≤</label>
                <input type="text" id="profileRole" disabled style="background: #f0f0f0; cursor: not-allowed;">
            </div>
            <div class="form-group">
                <label>H·ªç v√† t√™n <span class="required-mark">*</span></label>
                <input type="text" id="profileFullName" required placeholder="Nh·∫≠p h·ªç v√† t√™n">
            </div>
            <div class="form-group">
                <label>S·ªë ƒëi·ªán tho·∫°i <span class="required-mark">*</span></label>
                <input type="text" id="profilePhone" required placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
            </div>
            <div class="form-group">
                <label>Email <span class="required-mark">*</span></label>
                <input type="email" id="profileEmail" required placeholder="Nh·∫≠p email">
            </div>
             <div class="form-group">
                <label>Ng√†y sinh</label>
                <input type="date" id="profileDob">
            </div>
            <hr style="margin: 25px 0; border: none; border-top: 2px solid #f0f0f0;">
            <h3 style="margin-bottom: 15px; color: #333;">üîê ƒê·ªïi m·∫≠t kh·∫©u</h3>            
            <div class="form-group">
                <label>M·∫≠t kh·∫©u hi·ªán t·∫°i <span class="required-mark">*</span></label>
                <input type="password" id="currentPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
            </div>
            <div class="form-group">
                <label>M·∫≠t kh·∫©u m·ªõi <span class="required-mark">*</span></label>
                <input type="password" id="newPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi (t·ªëi thi·ªÉu 6 k√Ω t·ª±)">
            </div>
            <div class="form-group">
                <label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi <span class="required-mark">*</span></label>
                <input type="password" id="confirmNewPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
            </div>

            <div id="adminSection" style="display: none; margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
                <h3 style="margin-bottom: 15px; color: #333;">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h3>
                <div id="userList" style="background: #f9f9f9; border-radius: 8px; padding: 10px;">
                    <!-- User list rendered here -->
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeProfileModal()">H·ªßy</button>
                <button type="submit" class="btn-primary">üíæ L∆∞u thay ƒë·ªïi</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Data
    const defaultUsers = {
        admin: { username: 'admin', password: 'admin123', role: 'admin', fullName: 'Qu·∫£n tr·ªã vi√™n', dob: '1990-01-01' },
        user: { username: 'user', password: 'user123', role: 'user', fullName: 'Nguy·ªÖn VƒÉn A', dob: '1995-05-15' }
    };

    let users = { ...defaultUsers };
    let currentUser = null;
    let orders = [];
    let products = [
        { id: 1, name: 'Laptop Dell XPS 13', price: 25000000, stock: 10 },
        { id: 2, name: 'iPhone 15 Pro', price: 28000000, stock: 15 },
        { id: 3, name: 'Samsung Galaxy S24', price: 22000000, stock: 20 },
        { id: 4, name: 'AirPods Pro', price: 6000000, stock: 30 },
        { id: 5, name: 'iPad Air', price: 15000000, stock: 12 }
    ];
    let selectedItems = [];
    let currentFilter = 'all';
    let fpCurrentIdentity = '';

    // Initialize
    function init() {
        loadData();
        if (currentUser) {
            showApp();
        }
        setupAuthToggle();
    }

    function loadData() {
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) currentUser = JSON.parse(savedUser);

        const savedUsers = localStorage.getItem('registeredUsers');
        if (savedUsers) users = { ...defaultUsers, ...JSON.parse(savedUsers) };

        const savedOrders = localStorage.getItem('orders');
        if (savedOrders) orders = JSON.parse(savedOrders);

        const savedProducts = localStorage.getItem('products');
        if (savedProducts) products = JSON.parse(savedProducts);
    }

    function saveUsers() {
        const registeredUsers = {};
        Object.keys(users).forEach(key => {
            if (!defaultUsers[key]) {
                registeredUsers[key] = users[key];
            } else {
                // Save modification to default users too
                registeredUsers[key] = users[key];
            }
        });
        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
    }

    function saveData() {
        localStorage.setItem('orders', JSON.stringify(orders));
        localStorage.setItem('products', JSON.stringify(products));
    }
    function openRegisterPage() {
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("registerPage").style.display = "block";
    }
    function setupAuthToggle() {
        const toggleAuth = document.getElementById('toggleAuth');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const authSubtitle = document.getElementById('authSubtitle');
        const toggleText = document.getElementById('toggleText');
        const forgotPasswordLink = document.getElementById('forgotPasswordLink');
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        const authToggleContainer = document.getElementById('authToggleContainer');

        toggleAuth.addEventListener('click', function(e) {
            e.preventDefault();
            if (loginForm.style.display === 'none') {
                showLogin();
            } else 
{                // Show Register Form
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                forgotPasswordForm.style.display = 'none';
                authToggleContainer.style.display = 'none';
                authSubtitle.textContent = 'T·∫°o t√†i kho·∫£n m·ªõi';
                
                // Clear fields
                document.getElementById('regUsername').value = '';
                document.getElementById('regFullName').value = '';
                document.getElementById('regPassword').value = '';
                document.getElementById('regConfirmPassword').value = '';
            }
        });
        forgotPasswordLink.addEventListener('click', function(e) {
            e.preventDefault();
            loginForm.style.display = 'none';
            registerForm.style.display = 'none';
            forgotPasswordForm.style.display = 'block';
            authToggleContainer.style.display = 'none';
            authSubtitle.textContent = 'Kh√¥i ph·ª•c m·∫≠t kh·∫©u';
            
            // Reset FP steps
            document.getElementById('fpStep1').style.display = 'block';
            document.getElementById('fpStep2').style.display = 'none';
            document.getElementById('fpStep3').style.display = 'none';
            document.getElementById('fpIdentity').value = '';
        });
    }

    function showLogin() {
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('forgotPasswordForm').style.display = 'none';
        document.getElementById('authToggleContainer').style.display = 'block';
        document.getElementById('authSubtitle').textContent = 'ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c';
        document.getElementById('toggleText').textContent = 'Ch∆∞a c√≥ t√†i kho·∫£n?';
        document.getElementById('toggleAuth').textContent = 'ƒêƒÉng k√Ω ngay';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    }
    // Register
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('regUsername').value.trim();
            const fullName = document.getElementById('regFullName').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            // Validation
            if (username.length < 3) {
                alert('T√™n ƒëƒÉng nh·∫≠p ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±!');
                return;
            }

            if (users[username]) {
                alert('T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i!');
                return;
            }

            if (password.length < 6) {
                alert('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
                return;
            }

            if (password !== confirmPassword) {
                alert('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');
                return;
            }

            // Create new user
            users[username] = {
                username: username,
                password: password,
                fullName: fullName,
                role: 'user'
            };

            saveUsers();
            alert('‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.');

            // Switch to login form
            document.getElementById('toggleAuth').click();
            document.getElementById('username').value = username;
        });

    // Auth Logic
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('regUsername').value.trim();
        const fullName = document.getElementById('regFullName').value.trim();
        const password = document.getElementById('regPassword').value;
        const confirmPassword = document.getElementById('regConfirmPassword').value;

        if (users[username]) return alert('‚ö†Ô∏è T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i!');
        if (password.length < 6) return alert('‚ö†Ô∏è M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
        if (password !== confirmPassword) return alert('‚ö†Ô∏è M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');

        users[username] = { username, password, fullName, role: 'user', dob: '' };
        saveUsers();
        alert('‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.');
        showLogin();
    });

    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const user = Object.values(users).find(u => u.username === username && u.password === password);
        
        if (user) {
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(user));
            showApp();
        } else {
            alert('‚ö†Ô∏è T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!');
        }
    });

    // Forgot Password Flow
    document.getElementById('fpStep1').addEventListener('submit', function(e) {
        e.preventDefault();
        const identity = document.getElementById('fpIdentity').value.trim();
        // Mock check: assuming identity matches a username for this demo
        const user = Object.values(users).find(u => u.username === identity);
        if (!user) {
            alert('‚ö†Ô∏è T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i!');
            return;
        }
        fpCurrentIdentity = identity;
        alert('M√£ x√°c nh·∫≠n c·ªßa b·∫°n l√†: 123456');
        document.getElementById('fpStep1').style.display = 'none';
        document.getElementById('fpStep2').style.display = 'block';
        document.getElementById('fpOtp').value = '';
    });

    document.getElementById('fpStep2').addEventListener('submit', function(e) {
        e.preventDefault();
        const otp = document.getElementById('fpOtp').value.trim();
        if (otp !== '123456') {
            alert('‚ö†Ô∏è M√£ x√°c nh·∫≠n kh√¥ng ƒë√∫ng!');
            return;
        }
        document.getElementById('fpStep2').style.display = 'none';
        document.getElementById('fpStep3').style.display = 'block';
    });

    document.getElementById('fpStep3').addEventListener('submit', function(e) {
        e.preventDefault();
        const newPass = document.getElementById('fpNewPass').value;
        const confirmPass = document.getElementById('fpConfirmPass').value;
        
        if (newPass.length < 6) return alert('‚ö†Ô∏è M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
        if (newPass !== confirmPass) return alert('‚ö†Ô∏è M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');

        if (users[fpCurrentIdentity]) {
            users[fpCurrentIdentity].password = newPass;
            saveUsers();
            alert('‚úÖ ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
            showLogin();
        }
    });

    function logout() {
        currentUser = null;
        localStorage.removeItem('currentUser');
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('appPage').classList.remove('active');
        showLogin();
    }

    function showApp() {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('appPage').classList.add('active');
        document.getElementById('userName').textContent = currentUser.fullName;
        if (currentUser.role === 'user') {
            document.getElementById('revenueLabel').textContent = 'T·ªïng chi ti√™u';
        } else {
            document.getElementById('revenueLabel').textContent = 'Doanh thu';
        }
        loadProducts();
        updateStats();
        renderOrders();
    }

    function loadProducts() {
        const select = document.getElementById('productSelect');
        select.innerHTML = '<option value="">Ch·ªçn s·∫£n ph·∫©m</option>';
        products.forEach(product => {
            select.innerHTML += `<option value="${product.id}">${product.name} - ${formatCurrency(product.price)} (C√≤n: ${product.stock})</option>`;
        });
    }

    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
    }

    function updateStats() {
        let userOrders = currentUser.role === 'admin' ? orders : orders.filter(o => o.createdBy === currentUser.username);
        document.getElementById('totalOrders').textContent = userOrders.length;
        document.getElementById('pendingOrders').textContent = userOrders.filter(o => o.status === 'pending').length;
        document.getElementById('completedOrders').textContent = userOrders.filter(o => o.status === 'completed').length;
        const revenue = userOrders.filter(o => o.status === 'completed').reduce((sum, o) => sum + o.total, 0);
        document.getElementById('revenue').textContent = formatCurrency(revenue);
    }

    function filterOrders(status) {
        currentFilter = status;
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        renderOrders();
    }

    function renderOrders() {
        let filtered = orders;
        if (currentUser.role === 'user') filtered = filtered.filter(o => o.createdBy === currentUser.username);
        if (currentFilter !== 'all') filtered = filtered.filter(o => o.status === currentFilter);

        filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

        const container = document.getElementById('ordersContainer');
        if (filtered.length === 0) {
            container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üì¶</div><p>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p></div>`;
            return;
        }

        container.innerHTML = filtered.map(order => `
            <div class="order-card">
                <div class="order-header">
                    <div>
                        <div class="order-id">ƒê∆°n h√†ng #${order.id}</div>
                        <div class="order-date">${new Date(order.createdAt).toLocaleString('vi-VN')}</div>
                        ${currentUser.role === 'admin' ? `<div class="order-creator">Ng∆∞·ªùi t·∫°o: ${order.createdByName}</div>` : ''}
                    </div>
                    <span class="status-badge status-${order.status}">${getStatusText(order.status)}</span>
                </div>
                <div class="order-details">
                    <div class="customer-info">
                        <h4>Kh√°ch h√†ng</h4>
                        <p>${order.customerName}</p>
                        <p>${order.customerPhone}</p>
                        <p>${order.customerAddress}</p>
                    </div>
                    <div class="order-total">
                        <h4>T·ªïng ti·ªÅn</h4>
                        <p>${formatCurrency(order.total)}</p>
                    </div>
                </div>
                <div class="order-items">
                    <h4>S·∫£n ph·∫©m:</h4>
                    ${order.items.map(item => `<div class="item-row"><span>${item.productName} x ${item.quantity}</span><span>${formatCurrency(item.price * item.quantity)}</span></div>`).join('')}
                </div>
                <div class="order-actions">${getOrderActions(order)}</div>
            </div>
        `).join('');
    }

    function getStatusText(status) {
        const texts = { pending: '‚è≥ Ch·ªù x·ª≠ l√Ω', processing: 'üîÑ ƒêang x·ª≠ l√Ω', completed: '‚úÖ Ho√†n th√†nh', cancelled: '‚ùå ƒê√£ h·ªßy' };
        return texts[status] || status;
    }

    function getOrderActions(order) {
        let actions = '';
        if (currentUser.role === 'admin') {
            if (order.status === 'pending') actions += `<button class="btn-action btn-process" onclick="updateOrderStatus(${order.id}, 'processing')">X·ª≠ l√Ω ƒë∆°n h√†ng</button><button class="btn-action btn-cancel" onclick="updateOrderStatus(${order.id}, 'cancelled')">H·ªßy ƒë∆°n</button>`;
            else if (order.status === 'processing') actions += `<button class="btn-action btn-complete" onclick="updateOrderStatus(${order.id}, 'completed')">Ho√†n th√†nh</button>`;
            actions += `<button class="btn-action btn-delete" onclick="deleteOrder(${order.id})">üóëÔ∏è X√≥a</button>`;
        } else if (order.status === 'pending') {
            actions += `<button class="btn-action btn-cancel" onclick="updateOrderStatus(${order.id}, 'cancelled')">H·ªßy ƒë∆°n h√†ng</button>`;
        }
        return actions;
    }

    function openModal() {
        document.getElementById('orderModal').classList.add('active');
        selectedItems = [];
        ['customerName', 'customerPhone', 'customerAddress'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('selectedItems').innerHTML = '';
        document.getElementById('totalBox').style.display = 'none';
        loadProducts();
    }

    function closeModal() {
        document.getElementById('orderModal').classList.remove('active');
    }

    function addProduct() {
        const productId = parseInt(document.getElementById('productSelect').value);
        const quantity = parseInt(document.getElementById('quantity').value);
        if (!productId || quantity <= 0) return alert('Vui l√≤ng ch·ªçn s·∫£n ph·∫©m v√† s·ªë l∆∞·ª£ng!');
        const product = products.find(p => p.id === productId);
        if (product.stock < quantity) return alert('Kh√¥ng ƒë·ªß h√†ng trong kho!');

        const existing = selectedItems.find(i => i.productId === productId);
        if (existing) existing.quantity += quantity;
        else selectedItems.push({ productId, productName: product.name, price: product.price, quantity });

        document.getElementById('productSelect').value = '';
        document.getElementById('quantity').value = 1;
        renderSelectedItems();
    }

    function removeProduct(id) {
        selectedItems = selectedItems.filter(i => i.productId !== id);
        renderSelectedItems();
    }

    function renderSelectedItems() {
        const container = document.getElementById('selectedItems');
        if (selectedItems.length === 0) {
            container.innerHTML = '';
            document.getElementById('totalBox').style.display = 'none';
            return;
        }
        container.innerHTML = selectedItems.map(item => `
            <div class="selected-item">
                <div class="item-details"><h4>${item.productName}</h4><p>${formatCurrency(item.price)} x ${item.quantity}</p></div>
                <button class="btn-remove" onclick="removeProduct(${item.productId})">üóëÔ∏è X√≥a</button>
            </div>
        `).join('');
        const total = selectedItems.reduce((sum, i) => sum + (i.price * i.quantity), 0);
        document.getElementById('orderTotal').textContent = formatCurrency(total);
        document.getElementById('totalBox').style.display = 'flex';
    }

    document.getElementById('orderForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const customerName = document.getElementById('customerName').value.trim();
        const customerPhone = document.getElementById('customerPhone').value.trim();
        const customerAddress = document.getElementById('customerAddress').value.trim();

        if (!customerName || !customerPhone || !customerAddress) return alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin kh√°ch h√†ng!');
        if (selectedItems.length === 0) return alert('‚ö†Ô∏è Vui l√≤ng th√™m √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m!');

        selectedItems.forEach(item => {
            const p = products.find(p => p.id === item.productId);
            if (p) p.stock -= item.quantity;
        });

        orders.push({
            id: Date.now(),
            customerName, customerPhone, customerAddress,
            items: [...selectedItems],
            total: selectedItems.reduce((sum, i) => sum + (i.price * i.quantity), 0),
            status: 'pending',
            createdAt: new Date().toISOString(),
            createdBy: currentUser.username,
            createdByName: currentUser.fullName
        });

        saveData();
        closeModal();
        updateStats();
        renderOrders();
        alert('‚úÖ T·∫°o ƒë∆°n h√†ng th√†nh c√¥ng!');
    });

    function updateOrderStatus(id, status) {
        if (confirm(`X√°c nh·∫≠n chuy·ªÉn tr·∫°ng th√°i sang: ${getStatusText(status)}?`)) {
            const order = orders.find(o => o.id === id);
            if (order) {
                order.status = status;
                saveData();
                updateStats();
                renderOrders();
            }
        }
    }

    function deleteOrder(id) {
        if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë∆°n h√†ng n√†y?')) {
            const order = orders.find(o => o.id === id);
            if (order && order.status === 'pending') {
                order.items.forEach(item => {
                    const p = products.find(p => p.id === item.productId);
                    if (p) p.stock += item.quantity;
                });
            }
            orders = orders.filter(o => o.id !== id);
            saveData();
            updateStats();
            renderOrders();
        }
    }

    // Profile Logic
    function openProfileModal() {
        document.getElementById('profileModal').classList.add('active');
        document.getElementById('profileUsername').value = currentUser.username;
        document.getElementById('profileRole').value = currentUser.role === 'admin' ? 'Qu·∫£n tr·ªã vi√™n' : 'Kh√°ch h√†ng';
        document.getElementById('profileFullName').value = currentUser.fullName;
        document.getElementById('profileDob').value = currentUser.dob || '';
        ['currentPassword', 'newPassword', 'confirmNewPassword'].forEach(id => document.getElementById(id).value = '');

        // Admin only user management
        if (currentUser.role === 'admin') {
            document.getElementById('adminSection').style.display = 'block';
            renderUserList();
        } else {
            document.getElementById('adminSection').style.display = 'none';
        }
    }

    function closeProfileModal() {
        document.getElementById('profileModal').classList.remove('active');
    }

    function renderUserList() {
        const container = document.getElementById('userList');
        container.innerHTML = Object.values(users).map(u => `
            <div class="user-list-item">
                <div>
                    <strong>${u.username}</strong> - ${u.fullName}
                </div>
                ${u.username !== currentUser.username ? `
                    <button type="button" onclick="toggleRole('${u.username}')" class="filter-btn" style="font-size: 12px; padding: 5px 10px;">
                        ${u.role === 'admin' ? 'Gi√°ng xu·ªëng User' : 'ThƒÉng l√™n Admin'}
                    </button>
                ` : '<span style="font-size: 12px; color: #999;">(B·∫°n)</span>'}
            </div>
        `).join('');
    }

    function toggleRole(username) {
        if (users[username]) {
            users[username].role = users[username].role === 'admin' ? 'user' : 'admin';
            saveUsers();
            renderUserList();
            alert(`ƒê√£ ƒë·ªïi vai tr√≤ c·ªßa ${username} th√†nh ${users[username].role}`);
        }
    }

    window.toggleRole = toggleRole; // Expose to window for onclick

    document.getElementById('profileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const fullName = document.getElementById('profileFullName').value.trim();
        const dob = document.getElementById('profileDob').value;
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmNewPassword = document.getElementById('confirmNewPassword').value;

        if (currentPassword || newPassword || confirmNewPassword) {
            if (!currentPassword || !newPassword || !confirmNewPassword) return alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng m·∫≠t kh·∫©u!');
            if (currentPassword !== currentUser.password) return alert('‚ùå M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng!');
            if (newPassword.length < 6) return alert('‚ö†Ô∏è M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
            if (newPassword !== confirmNewPassword) return alert('‚ùå M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');
            currentUser.password = newPassword;
        }

        currentUser.fullName = fullName;
        currentUser.dob = dob;
        users[currentUser.username] = { ...users[currentUser.username], ...currentUser };
        
        // Update order creator names
        orders.forEach(o => { if (o.createdBy === currentUser.username) o.createdByName = fullName; });
        
        saveUsers();
        saveData();
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        closeProfileModal();
        showApp(); // Refresh UI
        alert('‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!');
    });

    // Modal close on click outside
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.classList.remove('active');
        }
    }

    window.onload = init;
</script>
</body>
</html>