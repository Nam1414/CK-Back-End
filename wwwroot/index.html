<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n l√Ω ƒë∆°n h√†ng</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõí</text></svg>">
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Login Page */
    .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
    }

    .login-box {
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        width: 100%;
        max-width: 400px;
    }

    .login-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .login-header h1 {
        color: #667eea;
        font-size: 28px;
        margin-bottom: 10px;
    }

    .login-header p {
        color: #666;
        font-size: 14px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
    }

    .form-group input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s;
    }

    .form-group input:focus {
        outline: none;
        border-color: #667eea;
    }

    .required-mark {
        color: red;
        margin-left: 4px;
    }

    .btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .btn:hover {
        transform: translateY(-2px);
    }

    .auth-links {
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
        color: #666;
    }

    .auth-links a {
        color: #667eea;
        font-weight: 600;
        text-decoration: none;
        margin-left: 5px;
        cursor: pointer;
    }
    /*Register Page*/
    .register-container
    {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .register-container {
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        width: 100%;
        max-width: 500px;
        animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .register-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .register-header h1 {
        color: #667eea;
        font-size: 28px;
        margin-bottom: 10px;
    }

    .register-header p {
        color: #666;
        font-size: 14px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
        font-size: 14px;
    }

    .required-mark {
        color: red;
        margin-left: 2px;
    }

    .form-group input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s;
    }

    .form-group input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-group input:disabled {
        background: #f0f0f0;
        cursor: not-allowed;
    }

    .password-strength {
        margin-top: 5px;
        font-size: 12px;
        height: 4px;
        background: #e0e0e0;
        border-radius: 2px;
        overflow: hidden;
        display: none;
    }

    .password-strength.show {
        display: block;
    }

    .password-strength-bar {
        height: 100%;
        transition: all 0.3s;
    }

    .password-strength-bar.weak {
        width: 33%;
        background: #dc3545;
    }

    .password-strength-bar.medium {
        width: 66%;
        background: #ffc107;
    }

    .password-strength-bar.strong {
        width: 100%;
        background: #28a745;
    }

    .password-hint {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }

    .btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-top: 10px;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn:active {
        transform: translateY(0);
    }

    .auth-links {
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
        color: #666;
    }

    .auth-links a {
        color: #667eea;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
    }

    .auth-links a:hover {
        text-decoration: underline;
    }

    .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
        animation: shake 0.5s;
    }

    .error-message.show {
        display: block;
    }

    .success-message {
        background: #d4edda;
        color: #155724;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
    }

    .success-message.show {
        display: block;
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    .info-box {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 12px;
        border-radius: 4px;
        margin-bottom: 20px;
        font-size: 13px;
        color: #1565c0;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    @media (max-width: 600px) {
        .register-container {
            padding: 30px 20px;
        }

        .form-row {
            grid-template-columns: 1fr;
        }
}

    /* Main App */
    .app-container {
        display: none;
    }

    .app-container.active {
        display: block;
    }

    .header {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header-left h1 {
        color: #333;
        font-size: 24px;
        margin-bottom: 5px;
    }

    .header-right {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .btn-logout {
        background: #dc3545;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .btn-logout:hover {
        background: #c82333;
    }

    /* Stats Cards */
    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: white;
    }

    /* Updated Colors */
    .stat-card.blue { background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%); } /* Total Orders */
    .stat-card.yellow { background: linear-gradient(135deg, #fda085 0%, #f6d365 100%); } /* Pending */
    .stat-card.green { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); } /* Completed */
    .stat-card.purple { background: linear-gradient(135deg, #b721ff 0%, #21d4fd 100%); } /* Revenue */

    .stat-info h3 {
        font-size: 14px;
        margin-bottom: 10px;
        opacity: 0.9;
    }

    .stat-info p {
        font-size: 32px;
        font-weight: bold;
    }

    .stat-icon {
        font-size: 48px;
        opacity: 0.8;
    }

    /* Action Bar */
    .action-bar {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #c471f5 0%, #fa71cd 100%); /* Updated Create Order Gradient */
        color: white;
        padding: 12px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        transition: transform 0.2s;
        margin-right: 6px;
        vertical-align: middle; 
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        filter: brightness(1.1);
    }

    .filter-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 10px 20px;
        border: 2px solid #e0e0e0;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .filter-btn:hover {
        background: #f5f5f5;
    }

    .filter-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
    }

    /* Orders List */
    .orders-container {
        display: grid;
        gap: 20px;
    }

    .order-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .order-id {
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }

    .order-date {
        color: #666;
        font-size: 13px;
    }

    .order-creator {
        color: #667eea;
        font-size: 13px;
        margin-top: 5px;
    }

    .status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
    }

    .status-pending { background: #fff3cd; color: #856404; }
    .status-processing { background: #cce5ff; color: #004085; }
    .status-completed { background: #d4edda; color: #155724; }
    .status-cancelled { background: #f8d7da; color: #721c24; }

    .order-details {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .customer-info h4 {
        color: #666;
        font-size: 13px;
        margin-bottom: 8px;
    }

    .customer-info p {
        color: #333;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .order-total {
        text-align: right;
    }

    .order-total h4 {
        color: #666;
        font-size: 13px;
        margin-bottom: 8px;
    }

    .order-total p {
        color: #667eea;
        font-size: 28px;
        font-weight: bold;
    }

    .order-items {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .order-items h4 {
        color: #333;
        margin-bottom: 12px;
        font-size: 14px;
    }

    .item-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #e0e0e0;
        font-size: 14px;
    }

    .item-row:last-child {
        border-bottom: none;
    }

    .order-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .btn-action {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        transition: all 0.3s;
    }

    .btn-process { background: #007bff; color: white; }
    .btn-process:hover { background: #0056b3; }

    .btn-complete { background: #28a745; color: white; }
    .btn-complete:hover { background: #218838; }

    .btn-cancel { background: #dc3545; color: white; }
    .btn-cancel:hover { background: #c82333; }

    .btn-delete { background: #6c757d; color: white; }
    .btn-delete:hover { background: #5a6268; }

    .btn-settings {
    background: linear-gradient(90deg, #33539E, #ba83a4);
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 5px;
    }
    .btn-settings:hover {
        filter: brightness(1.1);
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 700px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        margin-bottom: 25px;
    }

    .modal-header h2 {
        color: #333;
        font-size: 24px;
    }

    .product-selector {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    .product-selector select {
        flex: 1;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
    }

    .product-selector input {
        width: 80px;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
    }

    .btn-add {
        padding: 12px 24px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
    }

    .selected-items {
        margin-top: 20px;
    }

    .selected-item {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .item-details h4 {
        color: #333;
        margin-bottom: 5px;
    }

    .item-details p {
        color: #666;
        font-size: 13px;
    }

    .btn-remove {
        background: #dc3545;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
    }

    .order-total-box {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .order-total-box h3 {
        color: #333;
        font-size: 18px;
    }

    .order-total-box p {
        color: #667eea;
        font-size: 28px;
        font-weight: bold;
    }

    .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 25px;
    }

    .btn-secondary {
        padding: 12px 24px;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
    }

    .empty-state {
        background: white;
        padding: 60px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .empty-state-icon {
        font-size: 80px;
        color: #e0e0e0;
        margin-bottom: 20px;
    }

    .empty-state p {
        color: #999;
        font-size: 18px;
    }

    .user-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #eee;
    }
    .user-list-item:last-child {
        border-bottom: none;
    }

    @media (max-width: 768px) {
        .header {
            flex-direction: column;
            gap: 15px;
        }

        .order-details {
            grid-template-columns: 1fr;
        }

        .order-total {
            text-align: left;
        }

        .stats-container {
            grid-template-columns: 1fr;
        }

        .product-selector {
            flex-direction: column;
        }

        .product-selector input {
            width: 100%;
        }
    }
</style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
</head>
<body>
<!-- Login Page -->
<div id="loginPage" class="login-container">
    <div class="login-box">
        <div class="login-header">
            <h1>üõí Qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
            <p id="authSubtitle">ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c</p>
        </div>

        <!-- Login Form -->
        <form id="loginForm">
            <div class="form-group">
                <label>T√™n ƒëƒÉng nh·∫≠p <span class="required-mark">*</span></label>
                <input type="text" id="username" required placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
            </div>
            <div class="form-group">
                <label>M·∫≠t kh·∫©u <span class="required-mark">*</span></label>
                <input type="password" id="password" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
            </div>
            <div style="text-align: right; margin-bottom: 15px;">
                <a href="#" id="forgotPasswordLink" style="color: #667eea; font-size: 14px; text-decoration: none;">Qu√™n m·∫≠t kh·∫©u?</a>
            </div>
            <button type="submit" class="btn">ƒêƒÉng nh·∫≠p</button>
        </form>

        <!-- Register Form -->
        <form id="registerForm" style="display: none;">
            <div class="form-group">
                <label>T√™n ƒëƒÉng nh·∫≠p <span class="required-mark">*</span></label>
                <input type="text" id="regUsername" required placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
            </div>
            <div class="form-group">
                <label>H·ªç v√† t√™n <span class="required-mark">*</span></label>
                <input type="text" id="regFullName" required placeholder="Nh·∫≠p h·ªç v√† t√™n">
            </div>
            <div class="form-group">
                <label>Email <span class="required-mark">*</span></label>
                <input type="email" id="regEmail" required placeholder="Nh·∫≠p email (ƒë·ªÉ l·∫•y l·∫°i m·∫≠t kh·∫©u)">
            </div>
            <div class="form-group">
                <label>S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="tel" id="regPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
            </div>
            <div class="form-group">
                <label>M·∫≠t kh·∫©u <span class="required-mark">*</span></label>
                <input type="password" id="regPassword" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u (t·ªëi thi·ªÉu 6 k√Ω t·ª±)">
            </div>
            <div class="form-group">
                <label>X√°c nh·∫≠n m·∫≠t kh·∫©u <span class="required-mark">*</span></label>
                <input type="password" id="regConfirmPassword" required placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">
            </div>
            <button type="submit" class="btn">ƒêƒÉng k√Ω</button>
            <div class="auth-links">
                <a href="#" onclick="showLogin()">Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
            </div>
        </form>

        <!-- Forgot Password Form -->
        <div id="forgotPasswordForm" style="display: none;">
            <!-- Step 1: Request OTP -->
            <form id="fpStep1">
                <div class="form-group">
                    <label>Email / S·ªë ƒëi·ªán tho·∫°i <span class="required-mark">*</span></label>
                    <input type="text" id="fpIdentity" required placeholder="Nh·∫≠p email ho·∫∑c s·ªë ƒëi·ªán tho·∫°i">
                </div>
                <button type="submit" class="btn">G·ª≠i m√£ x√°c nh·∫≠n</button>
            </form>

            <!-- Step 2: Verify OTP -->
            <form id="fpStep2" style="display: none;">
                <div class="form-group">
                    <label>M√£ x√°c nh·∫≠n (OTP) <span class="required-mark">*</span></label>
                    <input type="text" id="fpOtp" required placeholder="Nh·∫≠p m√£ (123456)">
                </div>
                <button type="submit" class="btn">X√°c nh·∫≠n</button>
            </form>

            <!-- Step 3: Reset Password -->
            <form id="fpStep3" style="display: none;">
                <div class="form-group">
                    <label>M·∫≠t kh·∫©u m·ªõi <span class="required-mark">*</span></label>
                    <input type="password" id="fpNewPass" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
                </div>
                <div class="form-group">
                    <label>X√°c nh·∫≠n m·∫≠t kh·∫©u <span class="required-mark">*</span></label>
                    <input type="password" id="fpConfirmPass" required placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
                </div>
                <button type="submit" class="btn">ƒê·ªïi m·∫≠t kh·∫©u</button>
            </form>
            
             <div class="auth-links">
                <a href="#" onclick="showLogin()">Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
            </div>
        </div>

        <!-- Toggle Login/Register -->
        <div id="authToggleContainer" class="auth-links">
            <span id="toggleText">Ch∆∞a c√≥ t√†i kho·∫£n?</span>
            <button id="toggleAuth" style="background:none;border:none;color:#667eea;cursor:pointer;padding:0;">
                ƒêƒÉng k√Ω ngay
            </button>
        </div>
    </div>
</div>

<!-- Main App -->
<div id="appPage" class="app-container">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="header-left">
    <h1>üõí Qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
    
    <h3 id="userName" style="margin-bottom: 5px; color: #555;">Ng∆∞·ªùi d√πng</h3> 
    <p id="userRole">Qu·∫£n tr·ªã vi√™n</p>
</div>
            </div>
            <div class="header-right">
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
                <button class="btn-settings" onclick="openProfileModal()">
                    <i class="fa fa-cog"></i> C√†i ƒë·∫∑t
                </button>
                <button class="btn-logout" onclick="logout()">
                    <i class="fa fa-sign-out"></i> ƒêƒÉng xu·∫•t
                </button>
            </div>
        </div>

        <!-- Stats -->
         <div class="stats-container">
            <div class="stat-card blue">
                <div class="stat-info">
                    <h3>T·ªïng ƒë∆°n h√†ng</h3>
                    <p id="totalOrders">0</p>
                </div>
                <div class="stat-icon">
                    <i class="fa fa-archive"></i>
                </div>
            </div>
            <div class="stat-card yellow">
                <div class="stat-info">
                    <h3>Ch·ªù x·ª≠ l√Ω</h3>
                    <p id="pendingOrders">0</p>
                </div>
                <div class="stat-icon">
                    <i class="fa fa-clock-o"></i>
                </div>
            </div>
            <div class="stat-card green">
                <div class="stat-info">
                    <h3>Ho√†n th√†nh</h3>
                    <p id="completedOrders">0</p>
                </div>
                <div class="stat-icon">
                    <i class="fa fa-check-circle"></i>
                </div>
            </div>
            <div class="stat-card purple">
                <div class="stat-info">
                    <h3 id="revenueLabel">Doanh thu</h3>
                    <p id="revenue">0‚Ç´</p>
                </div>
                <div class="stat-icon">
                    <i class="fa fa-bar-chart"></i>
                </div>
            </div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
            <button class="btn-primary" onclick="openModal()">
                <i class="fa fa-plus"></i> T·∫°o ƒë∆°n h√†ng m·ªõi
            </button>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterOrders('all')">T·∫•t c·∫£</button>
                <button class="filter-btn" onclick="filterOrders('pending')">Ch·ªù x·ª≠ l√Ω</button>
                <button class="filter-btn" onclick="filterOrders('processing')">ƒêang x·ª≠ l√Ω</button>
                <button class="filter-btn" onclick="filterOrders('completed')">Ho√†n th√†nh</button>
                <button class="filter-btn" onclick="filterOrders('cancelled')">ƒê√£ h·ªßy</button>
            </div>
        </div>

        <!-- Orders List -->
        <div class="orders-container" id="ordersContainer">
            <!-- Content rendered by JS -->
        </div>
    </div>
</div>

<!-- Create Order Modal -->
<div id="orderModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>T·∫°o ƒë∆°n h√†ng m·ªõi</h2>
        </div>
        <form id="orderForm">
            <div class="form-group">
                <label>T√™n kh√°ch h√†ng <span class="required-mark">*</span></label>
                <input type="text" id="customerName" required placeholder="Nh·∫≠p t√™n kh√°ch h√†ng">
            </div>
            <div class="form-group">
                <label>S·ªë ƒëi·ªán tho·∫°i <span class="required-mark">*</span></label>
                <input type="tel" id="customerPhone" required placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
            </div>
            <div class="form-group">
                <label>ƒê·ªãa ch·ªâ <span class="required-mark">*</span></label>
                <input type="text" id="customerAddress" required placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
            </div>

            <hr style="margin: 25px 0; border: none; border-top: 2px solid #f0f0f0;">

            <h3 style="margin-bottom: 15px; color: #333;">Th√™m s·∫£n ph·∫©m</h3>
            <div class="product-selector">
                <select id="productSelect">
                    <option value="">Ch·ªçn s·∫£n ph·∫©m</option>
                </select>
                <input type="number" id="quantity" min="1" value="1" placeholder="S·ªë l∆∞·ª£ng">
                <button type="button" class="btn-add" onclick="addProduct()">Th√™m</button>
            </div>

            <div class="selected-items" id="selectedItems"></div>

            <div class="order-total-box" id="totalBox" style="display: none;">
                <h3>T·ªïng c·ªông:</h3>
                <p id="orderTotal">0‚Ç´</p>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeModal()">H·ªßy</button>
                <button type="submit" class="btn-primary">T·∫°o ƒë∆°n h√†ng</button>
            </div>
        </form>
    </div>
</div>

<!-- Profile Settings Modal -->
<div id="profileModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚öôÔ∏è C√†i ƒë·∫∑t t√†i kho·∫£n</h2>
        </div>
        <form id="profileForm">
    <div class="form-group">
        <label>T√™n ƒëƒÉng nh·∫≠p</label>
        <input type="text" id="profileUsername" disabled style="background: #f0f0f0; cursor: not-allowed;">
    </div>
    <div class="form-group">
        <label>Vai tr√≤</label>
        <input type="text" id="profileRole" disabled style="background: #f0f0f0; cursor: not-allowed;">
    </div>
    <div class="form-group">
        <label>H·ªç v√† t√™n <span class="required-mark">*</span></label>
        <input type="text" id="profileFullName" required placeholder="Nh·∫≠p h·ªç v√† t√™n">
    </div>
    <div class="form-group">
        <label>Email <span class="required-mark">*</span></label>
        <input type="email" id="profileEmail" required placeholder="Nh·∫≠p email">
    </div>
     <div class="form-group">
        <label>S·ªë ƒëi·ªán tho·∫°i</label>
        <input type="text" id="profilePhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
    </div>

    <hr style="margin: 25px 0; border: none; border-top: 2px solid #f0f0f0;">
    <h3 style="margin-bottom: 15px; color: #333;">üîê ƒê·ªïi m·∫≠t kh·∫©u (Kh√¥ng b·∫Øt bu·ªôc)</h3>            
    <div class="form-group">
        <label>M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
        <input type="password" id="currentPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
    </div>
    <div class="form-group">
        <label>M·∫≠t kh·∫©u m·ªõi</label>
        <input type="password" id="newPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi (t·ªëi thi·ªÉu 6 k√Ω t·ª±)">
    </div>
    <div class="form-group">
        <label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
        <input type="password" id="confirmNewPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
    </div>

    <div id="adminSection" style="display: none; margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
        <h3 style="margin-bottom: 15px; color: #333;">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h3>
        <div id="userList" style="background: #f9f9f9; border-radius: 8px; padding: 10px;"></div>
    </div>

    <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeProfileModal()">H·ªßy</button>
        <button type="submit" class="btn-primary">üíæ L∆∞u thay ƒë·ªïi</button>
    </div>
</form>
    </div>
</div>

<script>
    // C·∫•u h√¨nh
const API_URL = "/api";
let currentUser = null;
let token = localStorage.getItem('token'); // L·∫•y token t·ª´ storage

// H√†m helper ƒë·ªÉ g·ªçi API c√≥ x√°c th·ª±c
// Th√™m v√†o ƒë·∫ßu script n·∫øu ch∆∞a c√≥
async function fetchAPI(endpoint, method = 'GET', body = null) {
    const headers = { 'Content-Type': 'application/json' };
    if (token) headers['Authorization'] = `Bearer ${token}`;

    try {
        const res = await fetch(`${API_URL}/${endpoint}`, {
            method,
            headers,
            body: body ? JSON.stringify(body) : null
        });

        if (res.status === 401) { logout(); return null; }
        if (!res.ok) {
            const errorText = await res.text();
            throw new Error(errorText || res.statusText);
        }
        return await res.json();
    } catch (error) {
        alert("L·ªói API: " + error.message);
        return null;
    }
}
    // Data
    const defaultUsers = {
        admin: { username: 'admin', password: 'admin123', role: 'admin', fullName: 'Qu·∫£n tr·ªã vi√™n', dob: '1990-01-01' },
        user: { username: 'user', password: 'user123', role: 'user', fullName: 'Nguy·ªÖn VƒÉn A', dob: '1995-05-15' }
    };

    let users = { ...defaultUsers };
    //let currentUser = null;
    let orders = [];
    let products = [
        { id: 1, name: 'Laptop Dell XPS 13', price: 25000000, stock: 10 },
        { id: 2, name: 'iPhone 15 Pro', price: 28000000, stock: 15 },
        { id: 3, name: 'Samsung Galaxy S24', price: 22000000, stock: 20 },
        { id: 4, name: 'AirPods Pro', price: 6000000, stock: 30 },
        { id: 5, name: 'iPad Air', price: 15000000, stock: 12 }
    ];
    let selectedItems = [];
    let currentFilter = 'all';
    let fpCurrentIdentity = '';


//     async function init() {
//     const savedUser = localStorage.getItem('currentUser');
//     if (savedUser && token) {
//         currentUser = JSON.parse(savedUser);
//         showApp();
//     } else {
//         setupAuthToggle();
//     }
// }
function init() {
    // LU√îN LU√îN c√†i ƒë·∫∑t c√°c n√∫t b·∫•m chuy·ªÉn ƒë·ªïi giao di·ªán tr∆∞·ªõc
    setupAuthToggle();

    // Sau ƒë√≥ m·ªõi ki·ªÉm tra ƒëƒÉng nh·∫≠p
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser && token && savedUser !== "undefined") {
        try {
            currentUser = JSON.parse(savedUser);
            showApp();
        } catch (e) {
            logout();
        }
    } else {
        showLogin();
    }
}
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    const btn = e.target.querySelector('button');
    btn.innerText = "ƒêang x·ª≠ l√Ω..."; btn.disabled = true;

    try {
        const data = await fetchAPI('auth/login', 'POST', { username, password });
        
        if (data && (data.token || data.Token)) {
            token = data.token || data.Token;
            currentUser = data.user || data.User;
            localStorage.setItem('token', token);
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showApp();
        } else {
            alert('‚ùå Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!');
        }
    } catch (err) { alert('L·ªói k·∫øt n·ªëi'); }
    finally { btn.innerText = "ƒêƒÉng nh·∫≠p"; btn.disabled = false; }
});

    function loadData() {
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) currentUser = JSON.parse(savedUser);

        const savedUsers = localStorage.getItem('registeredUsers');
        if (savedUsers) users = { ...defaultUsers, ...JSON.parse(savedUsers) };

        const savedOrders = localStorage.getItem('orders');
        if (savedOrders) orders = JSON.parse(savedOrders);

        const savedProducts = localStorage.getItem('products');
        if (savedProducts) products = JSON.parse(savedProducts);
    }

    function saveUsers() {
        const registeredUsers = {};
        Object.keys(users).forEach(key => {
            if (!defaultUsers[key]) {
                registeredUsers[key] = users[key];
            } else {
                // Save modification to default users too
                registeredUsers[key] = users[key];
            }
        });
        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
    }

    function saveData() {
        localStorage.setItem('orders', JSON.stringify(orders));
        localStorage.setItem('products', JSON.stringify(products));
    }
    function openRegisterPage() {
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("registerPage").style.display = "block";
    }
 function setupAuthToggle() {
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const forgotForm = document.getElementById('forgotPasswordForm');
    
    const authSubtitle = document.getElementById('authSubtitle');
    const authToggleContainer = document.getElementById('authToggleContainer');
    
    // N√∫t chuy·ªÉn Login/Register
    const toggleAuth = document.getElementById('toggleAuth');
    
    // N√∫t Qu√™n m·∫≠t kh·∫©u
    const forgotLink = document.getElementById('forgotPasswordLink');

    // --- LOGIC 1: B·∫§M N√öT QU√äN M·∫¨T KH·∫®U ---
    if (forgotLink) {
        // Reset s·ª± ki·ªán c≈© ƒë·ªÉ tr√°nh l·ªói
        const newForgotLink = forgotLink.cloneNode(true);
        forgotLink.parentNode.replaceChild(newForgotLink, forgotLink);

        newForgotLink.addEventListener('click', function(e) {
            e.preventDefault();
            console.log("ƒê√£ b·∫•m Qu√™n m·∫≠t kh·∫©u");

            // ·∫®n Login, Hi·ªán Forgot
            loginForm.style.display = 'none';
            registerForm.style.display = 'none';
            forgotForm.style.display = 'block';
            authToggleContainer.style.display = 'none';
            authSubtitle.textContent = 'Kh√¥i ph·ª•c m·∫≠t kh·∫©u';

            // Reset c√°c b∆∞·ªõc OTP v·ªÅ ban ƒë·∫ßu
            document.getElementById('fpStep1').style.display = 'block';
            document.getElementById('fpStep2').style.display = 'none';
            document.getElementById('fpStep3').style.display = 'none';
            document.getElementById('fpIdentity').value = '';
        });
    }

    // --- LOGIC 2: B·∫§M N√öT ƒêƒÇNG K√ù NGAY / ƒêƒÇNG NH·∫¨P NGAY ---
    if (toggleAuth) {
        const newToggleBtn = toggleAuth.cloneNode(true);
        toggleAuth.parentNode.replaceChild(newToggleBtn, toggleAuth);

        newToggleBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (loginForm.style.display === 'none') {
                showLogin(); // ƒêang ·ªü trang kh√°c -> V·ªÅ Login
            } else {
                // ƒêang ·ªü Login -> Sang Register
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                forgotForm.style.display = 'none';
                authToggleContainer.style.display = 'block'; // V·∫´n hi·ªán n√∫t ƒë·ªÉ quay l·∫°i
                
                authSubtitle.textContent = 'T·∫°o t√†i kho·∫£n m·ªõi';
                document.getElementById('toggleText').textContent = 'ƒê√£ c√≥ t√†i kho·∫£n?';
                newToggleBtn.textContent = 'ƒêƒÉng nh·∫≠p ngay';
                
                // Clear form
                document.getElementById('regUsername').value = '';
                document.getElementById('regFullName').value = '';
                document.getElementById('regPassword').value = '';
            }
        });
    }
}

    function showLogin() {
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('forgotPasswordForm').style.display = 'none';
    document.getElementById('authToggleContainer').style.display = 'block';
    
    document.getElementById('authSubtitle').textContent = 'ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c';
    document.getElementById('toggleText').textContent = 'Ch∆∞a c√≥ t√†i kho·∫£n?';
    document.getElementById('toggleAuth').textContent = 'ƒêƒÉng k√Ω ngay';
    
    // Clear input
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
}
   // --- 1. ƒêƒÇNG K√ù ---
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // L·∫•y d·ªØ li·ªáu
    const username = document.getElementById('regUsername').value.trim();
    const fullName = document.getElementById('regFullName').value.trim();
    const email = document.getElementById('regEmail').value.trim(); // <--- C·∫ßn input HTML id="regEmail"
    const password = document.getElementById('regPassword').value;
    const confirmPassword = document.getElementById('regConfirmPassword').value;

    // üëá TH√äM ƒêO·∫†N N√ÄY: Ki·ªÉm tra d·ªØ li·ªáu r·ªóng
    if (!username || !email || !password) {
        return alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!');
    }

    if (password !== confirmPassword) return alert('M·∫≠t kh·∫©u kh√¥ng kh·ªõp!');

    const btn = e.target.querySelector('button');
    btn.innerText = "ƒêang x·ª≠ l√Ω..."; 
    btn.disabled = true;

    try {
        const res = await fetch(`${API_URL}/auth/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            // G·ª≠i ƒë√∫ng 4 tr∆∞·ªùng m√† Back-end y√™u c·∫ßu
            body: JSON.stringify({ username, fullName, email, password }) 
        });

        if (res.ok) {
            alert('‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.');
            
            // T·ª± ƒë·ªông ƒëi·ªÅn user m·ªõi v√†o form ƒëƒÉng nh·∫≠p cho ti·ªán
            showLogin();
            document.getElementById('username').value = username;
            document.getElementById('password').focus();
        } else {
            const err = await res.json();
            alert('‚ùå ' + (err.message || 'L·ªói ƒëƒÉng k√Ω'));
        }
    } catch (error) { 
        alert('L·ªói k·∫øt n·ªëi Server'); 
    } finally { 
        btn.innerText = "ƒêƒÉng k√Ω"; 
        btn.disabled = false; 
    }
});
    // Forgot Password Flow
    // Bi·∫øn t·∫°m ƒë·ªÉ l∆∞u th√¥ng tin khi chuy·ªÉn gi·ªØa c√°c b∆∞·ªõc
// --- BI·∫æN TO√ÄN C·ª§C CHO QU√äN M·∫¨T KH·∫®U ---
    let fpEmail = "";
    let fpOtpCode = "";
    

    // --- B∆Ø·ªöC 1: G·ª¨I Y√äU C·∫¶U OTP ---
    document.getElementById('fpStep1').addEventListener('submit', async function(e) {
        e.preventDefault();
        const emailInput = document.getElementById('fpIdentity').value.trim();
        
        const btn = e.target.querySelector('button');
        btn.innerText = "ƒêang g·ª≠i Email..."; 
        btn.disabled = true;
        
        try {
            const res = await fetch(`${API_URL}/auth/forgot-password`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ identity: emailInput })
            });

            if (res.ok) {
                fpEmail = emailInput; // L∆∞u l·∫°i email
                alert('‚úÖ ƒê√£ g·ª≠i m√£ OTP v√†o Email c·ªßa b·∫°n. Vui l√≤ng ki·ªÉm tra h·ªôp th∆∞!');
                document.getElementById('fpStep1').style.display = 'none';
                document.getElementById('fpStep2').style.display = 'block';
            } else {
                const err = await res.json();
                alert('‚ùå ' + (err.message || 'L·ªói g·ª≠i mail'));
            }
        } catch (error) { 
            alert('L·ªói k·∫øt n·ªëi Server'); 
        } finally { 
            btn.innerText = "G·ª≠i m√£ x√°c nh·∫≠n"; 
            btn.disabled = false; 
        }
    });

    // --- B∆Ø·ªöC 2: NH·∫¨P OTP ---
    document.getElementById('fpStep2').addEventListener('submit', function(e) {
        e.preventDefault();
        const otpInput = document.getElementById('fpOtp').value.trim();
        
        if (otpInput.length < 6) {
            alert("‚ö†Ô∏è M√£ OTP ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!");
            return;
        }

        fpOtpCode = otpInput; // L∆∞u l·∫°i OTP
        document.getElementById('fpStep2').style.display = 'none';
        document.getElementById('fpStep3').style.display = 'block';
    });

    // --- B∆Ø·ªöC 3: ƒê·ªîI M·∫¨T KH·∫®U M·ªöI ---
    document.getElementById('fpStep3').addEventListener('submit', async function(e) {
        e.preventDefault();
        const newPass = document.getElementById('fpNewPass').value;
        const confirmPass = document.getElementById('fpConfirmPass').value; // L·∫•y √¥ x√°c nh·∫≠n
        
        // 1. Ki·ªÉm tra kh·ªõp m·∫≠t kh·∫©u
        if (newPass.length < 6) return alert("‚ö†Ô∏è M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!");
        if (newPass !== confirmPass) return alert("‚ö†Ô∏è M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!");

        // 2. Kh√≥a n√∫t b·∫•m
        const btn = e.target.querySelector('button');
        const oldText = btn.innerText;
        btn.innerText = "ƒêang ƒë·ªïi m·∫≠t kh·∫©u...";
        btn.disabled = true;
        
        try {
            const res = await fetch(`${API_URL}/auth/reset-password`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    identity : fpEmail, 
                    otp: fpOtpCode, 
                    newPassword: newPass 
                })
            });

            if (res.ok) {
                alert('‚úÖ ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
                
                // Reset form v√† chuy·ªÉn v·ªÅ Login
                document.getElementById('fpStep1').reset();
                document.getElementById('fpStep2').reset();
                document.getElementById('fpStep3').reset();
                showLogin(); 
            } else {
                const err = await res.json();
                alert('‚ùå ' + (err.message || 'L·ªói ƒë·ªïi m·∫≠t kh·∫©u'));
            }
        } catch (error) { 
            alert('L·ªói k·∫øt n·ªëi Server'); 
        } finally {
            btn.innerText = oldText;
            btn.disabled = false;
        }
    });
  

    // --- B∆Ø·ªöC 2: NH·∫¨P OTP (CODE CHU·∫®N) ---
document.getElementById('fpStep2').addEventListener('submit', function(e) {
    e.preventDefault();
    const otpInput = document.getElementById('fpOtp').value.trim();
    
    // 1. Ch·ªâ ki·ªÉm tra ƒë·ªô d√†i (Validation c∆° b·∫£n)
    if (otpInput.length < 6) {
        alert("‚ö†Ô∏è M√£ OTP ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!");
        return; 
    }
    fpOtpCode = otpInput; 
    
    // 3. Chuy·ªÉn sang b∆∞·ªõc 3 (Nh·∫≠p m·∫≠t kh·∫©u m·ªõi)
    document.getElementById('fpStep2').style.display = 'none';
    document.getElementById('fpStep3').style.display = 'block';
});

    document.getElementById('fpStep3').addEventListener('submit', function(e) {
        e.preventDefault();
        const newPass = document.getElementById('fpNewPass').value;
        const confirmPass = document.getElementById('fpConfirmPass').value;
        
        if (newPass.length < 6) return alert('‚ö†Ô∏è M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
        if (newPass !== confirmPass) return alert('‚ö†Ô∏è M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');

        if (users[fpCurrentIdentity]) {
            users[fpCurrentIdentity].password = newPass;
            saveUsers();
            alert('‚úÖ ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
            showLogin();
        }
    });

 function logout() {
    currentUser = null;
    token = null;
    orders = []; // <--- QUAN TR·ªåNG: X√≥a s·∫°ch danh s√°ch ƒë∆°n h√†ng trong Ram
    
    localStorage.removeItem('currentUser');
    localStorage.removeItem('token');
    
    // Render l·∫°i giao di·ªán r·ªóng ƒë·ªÉ ch·∫Øc ch·∫Øn kh√¥ng c√≤n g√¨ hi·ªán l√™n
    document.getElementById('ordersContainer').innerHTML = ''; 
    document.getElementById('totalOrders').textContent = '0';

    document.getElementById('loginPage').style.display = 'flex';
    document.getElementById('appPage').classList.remove('active');
    
    showLogin();
}

    function showApp() {
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('appPage').classList.add('active');
    
    const userNameEl = document.getElementById('userName');
    if (userNameEl) userNameEl.textContent = currentUser.fullName;

    
    const roleText = (currentUser.role === 'Admin') ? 'Qu·∫£n tr·ªã vi√™n' : 'Ng∆∞·ªùi d√πng';
    document.getElementById('userRole').textContent = roleText;
    const statsContainer = document.querySelector('.stats-container');
    const adminSection = document.getElementById('adminSection');
    if (currentUser.role === 'Admin') {
        // N·∫øu l√† Admin: Hi·ªán th·ªëng k√™
        if(statsContainer) statsContainer.style.display = 'grid'; 
    } else {
        // N·∫øu l√† User: ·∫®n th·ªëng k√™ ƒëi
        if(statsContainer) statsContainer.style.display = 'none';
    }
    
    loadProducts();
    updateStats();
    renderOrders();
}

    async function loadProducts() {
    const select = document.getElementById('productSelect');
    select.innerHTML = '<option value="">ƒêang t·∫£i...</option>';
    
    // G·ªçi API l·∫•y s·∫£n ph·∫©m
    products = await fetchAPI('products'); // G√°n v√†o bi·∫øn products to√†n c·ª•c ƒë·ªÉ d√πng l·∫°i
    
    if (!products) return;

    select.innerHTML = '<option value="">Ch·ªçn s·∫£n ph·∫©m</option>';
    products.forEach(product => {
        select.innerHTML += `<option value="${product.id}">${product.name} - ${formatCurrency(product.price)} (C√≤n: ${product.stock})</option>`;
    });
}

    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
    }

    // Thay th·∫ø h√†m updateStats c≈© b·∫±ng h√†m n√†y
async function updateStats() {
    try {
        // 1. G·ªçi API l·∫•y danh s√°ch m·ªõi nh·∫•t t·ª´ Server
        const latestOrders = await fetchAPI('orders'); 
        
        if (latestOrders) {
            orders = latestOrders; // C·∫≠p nh·∫≠t bi·∫øn to√†n c·ª•c
        } else {
            orders = [];
        }
        renderOrders();
        if (currentUser.role !== 'Admin') return;
        // 2. T√≠nh to√°n s·ªë li·ªáu
        // L∆∞u √Ω: Backend ƒë√£ l·ªçc ƒë∆°n theo User r·ªìi, n√™n Frontend kh√¥ng c·∫ßn l·ªçc theo username n·ªØa
        document.getElementById('totalOrders').textContent = orders.length;
        
        // ƒê·∫øm theo tr·∫°ng th√°i (So s√°nh ch·ªØ th∆∞·ªùng ƒë·ªÉ ch·∫Øc ƒÉn)
        document.getElementById('pendingOrders').textContent = orders.filter(o => o.status.toLowerCase() === 'pending').length;
        document.getElementById('completedOrders').textContent = orders.filter(o => o.status.toLowerCase() === 'completed').length;
        
        const revenue = orders
            .filter(o => o.status.toLowerCase() === 'completed')
            .reduce((sum, o) => sum + o.totalAmount, 0); // L∆∞u √Ω: totalAmount (Back-end) vs total (c≈©)
            
        document.getElementById('revenue').textContent = formatCurrency(revenue);

        // 3. Render l·∫°i danh s√°ch ra m√†n h√¨nh lu√¥n
        renderOrders();

    } catch (e) {
        console.error("L·ªói c·∫≠p nh·∫≠t s·ªë li·ªáu:", e);
    }
}

    function filterOrders(status) {
        currentFilter = status;
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        renderOrders();
    }

    function renderOrders() {
    // 1. Ki·ªÉm tra an to√†n: N·∫øu ch∆∞a c√≥ ƒë∆°n ho·∫∑c user ch∆∞a load xong
    const container = document.getElementById('ordersContainer');
    if (!orders || orders.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üì¶</div><p>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p></div>`;
        return;
    }

    // 2. L·ªçc theo tr·∫°ng th√°i (Client-side filter)
    let filtered = orders;
    if (currentFilter !== 'all') {
        filtered = filtered.filter(o => o.status.toLowerCase() === currentFilter.toLowerCase());
    }

    // S·∫Øp x·∫øp m·ªõi nh·∫•t l√™n ƒë·∫ßu
    filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

    // 3. Render HTML
    container.innerHTML = filtered.map(order => {
        // T√≠nh nƒÉng ph√¢n quy·ªÅn hi·ªÉn th·ªã n√∫t b·∫•m
        const isAdmin = currentUser && currentUser.role === 'Admin';
        const isPending = order.status === 'pending';

        // X·ª≠ l√Ω danh s√°ch s·∫£n ph·∫©m (L∆∞u √Ω: Back-end tr·∫£ v·ªÅ 'orderDetails' ch·ª©a 'product')
        const itemsHtml = order.orderDetails ? order.orderDetails.map(detail => {
            // Check null an to√†n cho product ph√≤ng tr∆∞·ªùng h·ª£p s·∫£n ph·∫©m b·ªã x√≥a
            const productName = detail.product ? detail.product.name : "S·∫£n ph·∫©m ƒë√£ x√≥a"; 
            const totalItemPrice = detail.quantity * detail.unitPrice;
            return `<div class="item-row">
                        <span>${productName} x ${detail.quantity}</span>
                        <span>${formatCurrency(totalItemPrice)}</span>
                    </div>`;
        }).join('') : '';

        return `
            <div class="order-card">
                <div class="order-header">
                    <div>
                        <div class="order-id">ƒê∆°n h√†ng #${order.id}</div>
                        <div class="order-date">${new Date(order.createdAt).toLocaleString('vi-VN')}</div>
                        ${isAdmin ? `<div class="order-creator">Kh√°ch: ${order.customerName}</div>` : ''}
                    </div>
                    <span class="status-badge status-${order.status.toLowerCase()}">${getStatusText(order.status)}</span>
                </div>
                
                <div class="order-details">
                    <div class="customer-info">
                        <h4>Th√¥ng tin giao h√†ng</h4>
                        <p>${order.customerName}</p>
                        <p>${order.customerPhone}</p>
                        <p>${order.customerAddress}</p>
                    </div>
                    <div class="order-total">
                        <h4>T·ªïng ti·ªÅn</h4>
                        <p>${formatCurrency(order.totalAmount)}</p>
                    </div>
                </div>

                <div class="order-items">
                    <h4>Chi ti·∫øt s·∫£n ph·∫©m:</h4>
                    ${itemsHtml}
                </div>

                <div class="order-actions">
                    ${getOrderActions(order)}
                </div>
            </div>
        `;
    }).join('');
}
    function getStatusText(status) {
        const texts = { pending: '‚è≥ Ch·ªù x·ª≠ l√Ω', processing: 'üîÑ ƒêang x·ª≠ l√Ω', completed: '‚úÖ Ho√†n th√†nh', cancelled: '‚ùå ƒê√£ h·ªßy' };
        return texts[status] || status;
    }

   function getOrderActions(order) {
    if (!currentUser) return '';
    
    let actions = '';
    const status = order.status.toLowerCase();

    // TR∆Ø·ªúNG H·ª¢P 1: N·∫æU L√Ä ADMIN (Quy·ªÅn l·ª±c t·ªëi th∆∞·ª£ng)
    if (currentUser.role === 'Admin') {
        if (status === 'pending') {
            actions += `<button class="btn-action btn-process" onclick="updateOrderStatus(${order.id}, 'processing')">Duy·ªát ƒë∆°n</button>`;
            actions += `<button class="btn-action btn-cancel" onclick="updateOrderStatus(${order.id}, 'cancelled')">H·ªßy ƒë∆°n</button>`;
        } else if (status === 'processing') {
            actions += `<button class="btn-action btn-complete" onclick="updateOrderStatus(${order.id}, 'completed')">Ho√†n th√†nh</button>`;
            actions += `<button class="btn-action btn-cancel" onclick="updateOrderStatus(${order.id}, 'cancelled')">H·ªßy</button>`;
        }
        actions += `<button class="btn-action btn-delete" onclick="deleteOrder(${order.id})">üóëÔ∏è X√≥a</button>`;
    } 
    // TR∆Ø·ªúNG H·ª¢P 2: N·∫æU L√Ä USER (KH√ÅCH H√ÄNG)
    else {
        // Ki·ªÉm tra xem ƒë∆°n n√†y c√≥ ph·∫£i c·ªßa m√¨nh kh√¥ng (d√π API get ƒë√£ l·ªçc, nh∆∞ng check l·∫°i cho ch·∫Øc)
        // L∆∞u √Ω: order.userId (API tr·∫£ v·ªÅ) so v·ªõi currentUser.id
        if (order.userId === currentUser.id) {
            // Kh√°ch ch·ªâ ƒë∆∞·ª£c h·ªßy khi ƒë∆°n c√≤n ƒëang 'pending'
            if (status === 'pending') {
                actions += `<button class="btn-action btn-cancel" onclick="updateOrderStatus(${order.id}, 'cancelled')">H·ªßy ƒë∆°n h√†ng</button>`;
            }
        }
    }
    return actions;
}

    function openModal() {
        document.getElementById('orderModal').classList.add('active');
        selectedItems = [];
        ['customerName', 'customerPhone', 'customerAddress'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('selectedItems').innerHTML = '';
        document.getElementById('totalBox').style.display = 'none';
        loadProducts();
    }

    function closeModal() {
        document.getElementById('orderModal').classList.remove('active');
    }

    function addProduct() {
        const productId = parseInt(document.getElementById('productSelect').value);
        const quantity = parseInt(document.getElementById('quantity').value);
        if (!productId || quantity <= 0) return alert('Vui l√≤ng ch·ªçn s·∫£n ph·∫©m v√† s·ªë l∆∞·ª£ng!');
        const product = products.find(p => p.id === productId);
        if (product.stock < quantity) return alert('Kh√¥ng ƒë·ªß h√†ng trong kho!');

        const existing = selectedItems.find(i => i.productId === productId);
        if (existing) existing.quantity += quantity;
        else selectedItems.push({ productId, productName: product.name, price: product.price, quantity });

        document.getElementById('productSelect').value = '';
        document.getElementById('quantity').value = 1;
        renderSelectedItems();
    }

    function removeProduct(id) {
        selectedItems = selectedItems.filter(i => i.productId !== id);
        renderSelectedItems();
    }

    function renderSelectedItems() {
        const container = document.getElementById('selectedItems');
        if (selectedItems.length === 0) {
            container.innerHTML = '';
            document.getElementById('totalBox').style.display = 'none';
            return;
        }
        container.innerHTML = selectedItems.map(item => `
            <div class="selected-item">
                <div class="item-details"><h4>${item.productName}</h4><p>${formatCurrency(item.price)} x ${item.quantity}</p></div>
                <button class="btn-remove" onclick="removeProduct(${item.productId})">üóëÔ∏è X√≥a</button>
            </div>
        `).join('');
        const total = selectedItems.reduce((sum, i) => sum + (i.price * i.quantity), 0);
        document.getElementById('orderTotal').textContent = formatCurrency(total);
        document.getElementById('totalBox').style.display = 'flex';
    }

   document.getElementById('orderForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    // 1. L·∫•y d·ªØ li·ªáu t·ª´ Form
    const customerName = document.getElementById('customerName').value.trim();
    const customerPhone = document.getElementById('customerPhone').value.trim();
    const customerAddress = document.getElementById('customerAddress').value.trim();

    // 2. Validate c∆° b·∫£n
    if (!customerName || !customerPhone || !customerAddress) {
        alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin kh√°ch h√†ng!');
        return;
    }
    if (selectedItems.length === 0) {
        alert('‚ö†Ô∏è Vui l√≤ng th√™m √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m!');
        return;
    }

    // 3. Chu·∫©n b·ªã Payload (D·ªØ li·ªáu g·ª≠i ƒëi)
    // C·∫§U TR√öC N√ÄY PH·∫¢I KH·ªöP V·ªöI CreateOrderDto TRONG C#
    const payload = {
        customerName: customerName,
        customerPhone: customerPhone,
        customerAddress: customerAddress,
        items: selectedItems.map(item => ({
            productId: parseInt(item.productId), // ƒê·∫£m b·∫£o l√† s·ªë nguy√™n
            quantity: parseInt(item.quantity)    // ƒê·∫£m b·∫£o l√† s·ªë nguy√™n
        }))
    };

    console.log("ƒêang g·ª≠i ƒë∆°n h√†ng:", payload); // B·∫≠t F12 -> Console ƒë·ªÉ xem d√≤ng n√†y

    // Kh√≥a n√∫t b·∫•m ƒë·ªÉ tr√°nh double-click
    const submitBtn = document.querySelector('#orderForm button[type="submit"]');
    const originalText = submitBtn.innerText;
    submitBtn.innerText = "ƒêang x·ª≠ l√Ω...";
    submitBtn.disabled = true;

    try {
        // 4. G·ªçi API
        const result = await fetchAPI('orders', 'POST', payload);

        if (result) {
            alert('‚úÖ T·∫°o ƒë∆°n h√†ng th√†nh c√¥ng!');
            closeModal();
            
            // Reset form
            document.getElementById('orderForm').reset();
            selectedItems = []; 
            document.getElementById('selectedItems').innerHTML = '';
            document.getElementById('totalBox').style.display = 'none';

            // T·∫£i l·∫°i danh s√°ch ƒë∆°n h√†ng
            updateStats(); 
        }
    } catch (err) {
        console.error("L·ªói t·∫°o ƒë∆°n:", err);
        alert('‚ùå Kh√¥ng th·ªÉ t·∫°o ƒë∆°n h√†ng. Vui l√≤ng ki·ªÉm tra l·∫°i!');
    } finally {
        // M·ªü l·∫°i n√∫t b·∫•m
        submitBtn.innerText = originalText;
        submitBtn.disabled = false;
    }
});

    async function updateOrderStatus(id, status) {
    const statusLabel = getStatusText(status);
    if (confirm(`X√°c nh·∫≠n chuy·ªÉn tr·∫°ng th√°i sang: ${statusLabel}?`)) {
        
        // G·ªçi API PUT Status
        // L∆∞u √Ω: Backend nh·∫≠n [FromBody] string, n√™n g·ª≠i chu·ªói json d·∫°ng "completed"
        const result = await fetchAPI(`orders/${id}/status`, 'PUT', status);

        if (result) {
            alert('C·∫≠p nh·∫≠t th√†nh c√¥ng!');
            updateStats(); // T·∫£i l·∫°i danh s√°ch
        }
    }
}

    async function deleteOrder(id) {
    if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë∆°n h√†ng n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
        
        // G·ªçi API DELETE
        const result = await fetchAPI(`orders/${id}`, 'DELETE');

        if (result) {
            alert('‚úÖ ƒê√£ x√≥a ƒë∆°n h√†ng');
            updateStats(); // T·∫£i l·∫°i danh s√°ch
        }
    }
}

    // Profile Logic
    async function openProfileModal() {
    document.getElementById('profileModal').classList.add('active');
    
    // X√≥a tr·∫Øng c√°c √¥ m·∫≠t kh·∫©u m·ªói khi m·ªü l·∫°i
    document.getElementById('currentPassword').value = '';
    document.getElementById('newPassword').value = '';
    document.getElementById('confirmNewPassword').value = '';

    try {
        // G·ªçi API l·∫•y th√¥ng tin m·ªõi nh·∫•t
        const data = await fetchAPI('users/profile');
        
        if (data) {
            document.getElementById('profileUsername').value = data.username;
            document.getElementById('profileRole').value = data.role === 'Admin' ? 'Qu·∫£n tr·ªã vi√™n' : 'Kh√°ch h√†ng';
            document.getElementById('profileFullName').value = data.fullName;
            document.getElementById('profileEmail').value = data.email;
            document.getElementById('profilePhone').value = data.phoneNumber || '';

            // N·∫øu l√† Admin th√¨ t·∫£i danh s√°ch user
            if (data.role === 'Admin') {
                document.getElementById('adminSection').style.display = 'block';
                loadUserList();
            } else {
                document.getElementById('adminSection').style.display = 'none';
            }
        }
    } catch (error) { alert('L·ªói t·∫£i th√¥ng tin c√° nh√¢n'); }
}

function closeProfileModal() {
    document.getElementById('profileModal').classList.remove('active');
}

// 2. X·ª≠ l√Ω L∆∞u thay ƒë·ªïi (Submit Form)
document.getElementById('profileForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // --- PH·∫¶N 1: C·∫¨P NH·∫¨T TH√îNG TIN C∆† B·∫¢N ---
    const infoPayload = {
        fullName: document.getElementById('profileFullName').value.trim(),
        email: document.getElementById('profileEmail').value.trim(),
        phoneNumber: document.getElementById('profilePhone').value.trim()
    };

    try {
        const resInfo = await fetchAPI('users/profile', 'PUT', infoPayload);
        if (!resInfo) return; // L·ªói th√¨ d·ª´ng

        let message = '‚úÖ ' + resInfo.message;

        // --- PH·∫¶N 2: ƒê·ªîI M·∫¨T KH·∫®U (N·∫æU C√ì NH·∫¨P) ---
        const currentPass = document.getElementById('currentPassword').value;
        const newPass = document.getElementById('newPassword').value;
        const confirmPass = document.getElementById('confirmNewPassword').value;

        // Ch·ªâ x·ª≠ l√Ω n·∫øu ng∆∞·ªùi d√πng c√≥ nh·∫≠p m·∫≠t kh·∫©u
        if (currentPass || newPass || confirmPass) {
            if (!currentPass || !newPass) {
                return alert('‚ö†Ô∏è ƒê·ªÉ ƒë·ªïi m·∫≠t kh·∫©u, vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i v√† m·ªõi!');
            }
            if (newPass.length < 6) {
                return alert('‚ö†Ô∏è M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±');
            }
            if (newPass !== confirmPass) {
                return alert('‚ö†Ô∏è M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp');
            }

            const passPayload = { currentPassword: currentPass, newPassword: newPass };
            const resPass = await fetchAPI('users/change-password', 'PUT', passPayload);
            
            if (resPass) {
                message += '\n‚úÖ ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!';
            } else {
                // N·∫øu ƒë·ªïi pass l·ªói th√¨ th√¥ng b√°o v√† ch∆∞a ƒë√≥ng modal v·ªôi
                return alert('‚ùå ƒê·ªïi m·∫≠t kh·∫©u th·∫•t b·∫°i: ' + (resPass?.message || 'L·ªói server'));
            }
        }

        // N·∫øu m·ªçi th·ª© ok
        alert(message);
        closeProfileModal();
        
        // C·∫≠p nh·∫≠t l·∫°i th√¥ng tin hi·ªÉn th·ªã b√™n ngo√†i (Header)
        if(resInfo.user) {
            currentUser = resInfo.user;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showApp(); 
        }

    } catch (error) {
        alert('C√≥ l·ªói x·∫£y ra: ' + error.message);
    }
});

// 3. (Admin) T·∫£i danh s√°ch User
async function loadUserList() {
    const container = document.getElementById('userList');
    container.innerHTML = '<p>ƒêang t·∫£i danh s√°ch...</p>';
    
    const users = await fetchAPI('users'); 
    if (!users) return;

    if (users.length === 0) container.innerHTML = '<p>Kh√¥ng c√≥ user n√†o</p>';
    else {
        container.innerHTML = users.map(u => `
            <div class="user-list-item">
                <div>
                    <strong>${u.username}</strong> - ${u.fullName} <br>
                    <small style="color: #666;">${u.email} (${u.role})</small>
                </div>
                ${u.username !== currentUser.username && u.username !== 'admin' ? `
                    <button type="button" onclick="toggleUserRole(${u.id})" class="filter-btn" style="font-size: 12px; padding: 5px 10px;">
                        ${u.role === 'Admin' ? 'Gi√°ng xu·ªëng User' : 'ThƒÉng l√™n Admin'}
                    </button>
                ` : '<span style="font-size: 12px; color: #999; font-style: italic;">(Kh√¥ng th·ªÉ s·ª≠a)</span>'}
            </div>
        `).join('');
    }
}

// 4. (Admin) ƒê·ªïi quy·ªÅn User
async function toggleUserRole(userId) {
    if(!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën thay ƒë·ªïi quy·ªÅn c·ªßa ng∆∞·ªùi d√πng n√†y?')) return;
    
    const res = await fetchAPI(`users/${userId}/role`, 'PUT');
    if (res) {
        alert(res.message);
        loadUserList(); // T·∫£i l·∫°i danh s√°ch ngay
    }
}
// Expose h√†m ra global ƒë·ªÉ HTML g·ªçi ƒë∆∞·ª£c onclick
window.toggleUserRole = toggleUserRole;

    document.getElementById('profileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const fullName = document.getElementById('profileFullName').value.trim();
        const dob = document.getElementById('profileDob').value;
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmNewPassword = document.getElementById('confirmNewPassword').value;

        if (currentPassword || newPassword || confirmNewPassword) {
            if (!currentPassword || !newPassword || !confirmNewPassword) return alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng m·∫≠t kh·∫©u!');
            if (currentPassword !== currentUser.password) return alert('‚ùå M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng!');
            if (newPassword.length < 6) return alert('‚ö†Ô∏è M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
            if (newPassword !== confirmNewPassword) return alert('‚ùå M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');
            currentUser.password = newPassword;
        }

        currentUser.fullName = fullName;
        currentUser.dob = dob;
        users[currentUser.username] = { ...users[currentUser.username], ...currentUser };
        
        // Update order creator names
        orders.forEach(o => { if (o.createdBy === currentUser.username) o.createdByName = fullName; });
        
        saveUsers();
        saveData();
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        closeProfileModal();
        showApp(); // Refresh UI
        alert('‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!');
    });

    // Modal close on click outside
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.classList.remove('active');
        }
    }

    window.onload = init;
</script>
</body>
</html>